---
title: "p8105 Homework 2"
author: Tory Lynch 
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
```

#### Problem 1

##### Import CSV file and clean data 
```{r}
MTA_data <- read_csv(file = "./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv", 
                     col_types = "cccddccccccciiiicccccclclcccddcc") %>%
            janitor::clean_names() %>%
            dplyr::select(line:entry, vending, ada) %>%
            mutate(entry = as.logical(ifelse(entry == "YES", TRUE, FALSE))) 

skimr::skim(MTA_data)
```

```{r, include = FALSE}
dimensions <- dim(MTA_data)
row <- dimensions[1]
column <- dimensions[2]
```

##### Description of dataset 
The dataset contains information about all of the NYC MTA subway station lines, including the station stops, locations (latitude, longitude, cross streets) and routes served (i.e. the numbers and/or letters of the trains on each line). Many of the variables address the accessiblity of the station line; these data describe the entrance and exit type for each station, whether or not they are staffed, have metro card vending machines, and are ADA-compliant. The dataset also includes information about the station entrances (lat, long, corner position) that is separate from the station location. The data cleaning process involved restricting the dataset from 32 to 19 variables. I removed the variables that described the entrance location (lat, long, corner position), whether the stations were exit only, and if the stations were staffed. I also converted the entry variable, which identifies whether a station has an entrance, from a character to a logical variable. The dimensions of the data are `r row` by `r column`. The data are tidier because I arranged them in a clear format by selecting the relevant variables and by converting a variable into an easier-to-use format. 

##### Questions 
```{r}
#Question 1
table_distinct_stations <- distinct(MTA_data) 
num_distinct_stations <- as.integer(count(table_distinct_stations))

#Question 2 
proportion_ada_compliant <- (round(sum(table_distinct_stations$ada == "TRUE") / num_distinct_stations, 3))*100

#Question 3 
prop_entry_no_vending <- (round((sum(table_distinct_stations$vending == "NO" & 
          table_distinct_stations$entry == "TRUE") /sum(table_distinct_stations$vending == "NO")), 3))*100
```

There are `r num_distinct_stations` distinct stations, of which `r proportion_ada_compliant`% are ADA-compliant. Among the stations without vending, `r prop_entry_no_vending`% allow entrance. 

##### Reformat data

```{r}
stations_name_and_route <- gather(table_distinct_stations, key = route, value = line, route1: route11) %>%
  filter(!is.na(line)) %>%
  select(-route)

stations_per_line <- stations_name_and_route %>%
  group_by(line, ada) %>%
  tally()
total_a_train <- 34+57
percent_ada_compliant <- (34 / total_a_train)*100
```

There are `r total_a_train` distinct stations that serve the A line, `r percent_ada_compliant`% of which are ADA compliant.

#### Problem 2

##### Import Excel file and clean data
```{r}
#Trashwheel data
trashwheel_data <- read_excel("data/HealthyHarborWaterWheelTotals2018-7-28.xlsx", 
                              sheet = "Mr. Trash Wheel", 
                              range = cell_cols("A:N")) %>% 
                   janitor::clean_names() %>% 
                   filter(!is.na(dumpster)) %>% 
                   mutate(sports_balls = as.integer(round(sports_balls, 0)))

#2017 precipitation data  
precip_2017 <- read_excel("data/HealthyHarborWaterWheelTotals2018-7-28.xlsx", 
                              sheet = "2017 Precipitation", 
                              skip = 2, 
                              col_names = c("Month", "Precip")) %>%  
               filter(!is.na(Month)) %>% 
               mutate(Year = 2017)

#2016 precipitation data 
precip_2016 <- read_excel("data/HealthyHarborWaterWheelTotals2018-7-28.xlsx", 
                              sheet = "2016 Precipitation", 
                              skip = 2, 
                              col_names = c("Month", "Precip")) %>%  
               filter(!is.na(Month)) %>% 
               mutate(Year = 2016)                            

#Combine precipitation data 
total_precip_data <- bind_rows(precip_2016, precip_2017) %>% 
               mutate(month = as.character(month.name[Month])) %>% 
               select(-Month)
```

```{r}
skimr::skim(trashwheel_data)
skimr::skim(total_precip_data)

total_2017_precip <- total_precip_data %>% 
  group_by(Year) %>% 
  tally(Precip)

total_precip_data <- total_precip_data %>% 
  mutate()

sportsballs_by_year <- trashwheel_data %>% 
  group_by(year) %>% 
  summarise(n = median(sports_balls))
```


